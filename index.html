<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Casa Carmaretti | POS</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Inconsolata:wght@400;700&display=swap"
    rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- Framework -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <link rel="stylesheet" href="css/styles.css" />
</head>

<body class="bg-dark text-white">

  <!-- App Container -->
  <div class="app-layout d-flex flex-column h-100">

    <!-- 1. Header (Desktop & Mobile) -->
    <header
      class="app-header d-flex align-items-center justify-content-between px-3 py-2 border-bottom border-secondary bg-darker">
      <div class="d-flex align-items-center gap-2">
        <div class="brand-logo text-gold fs-4"><i class="bi bi-fire"></i></div>
        <div>
          <h1 class="h6 fw-bold mb-0 text-white tracking-wide">CASA CARMARETTI</h1>
          <div class="d-flex align-items-center gap-2">
            <span class="badge bg-gold text-dark x-small">POS v4.0</span>
            <span id="kds-clock" class="text-white-50 x-small font-mono d-none d-lg-block">--:--</span>
          </div>
        </div>
      </div>

      <!-- User Profile (Desktop Only - Mobile uses 'More' tab) -->
      <div class="d-none d-lg-flex align-items-center gap-4">
        <!-- Desktop Stats -->
        <div class="d-flex align-items-center gap-3 border-end border-secondary pe-4">
          <div class="text-end">
            <span class="d-block x-small text-white-50">SİPARİŞ</span>
            <strong id="waiterOrderCount" class="text-white">0</strong>
          </div>
          <div class="text-end">
            <span class="d-block x-small text-white-50">SERVİS</span>
            <strong id="waiterServiceShare" class="text-success">0 $</strong>
          </div>
        </div>

        <div class="d-flex align-items-center gap-3">
          <div class="text-end">
            <p class="mb-0 fw-bold small text-white" id="activeWaiterName">Giriş Yap</p>
            <p class="mb-0 x-small text-gold" id="waiterRank">-</p>
          </div>
          <div class="avatar bg-gold text-dark"><i class="bi bi-person-fill"></i></div>
        </div>
      </div>
    </header>

    <!-- 2. Main Content Area -->
    <main class="flex-grow-1 overflow-hidden position-relative d-flex">

      <!-- VIEW: POS (Menu & Ticket) -->
      <div id="pos-view" class="d-flex w-100 h-100">

        <!-- Left: Product Grid (Full width on mobile) -->
        <div class="flex-grow-1 d-flex flex-column h-100 bg-dark">
          <!-- Categories / Filter Bar -->
          <div class="filter-bar d-flex gap-2 p-3 overflow-x-auto border-bottom border-dark-subtle">
            <div class="search-wrapper flex-grow-1 flex-md-grow-0" style="min-width: 200px;">
              <div class="input-group input-group-sm">
                <span class="input-group-text bg-darker border-secondary text-secondary"><i
                    class="bi bi-search"></i></span>
                <input type="text" id="productSearch" class="form-control bg-darker border-secondary text-white"
                  placeholder="Ürün Ara...">
              </div>
            </div>
            <!-- Toggle Views Buttons (Desktop) -->
            <button id="btn-toggle-kds"
              class="btn btn-outline-light btn-sm d-none d-lg-inline-flex align-items-center gap-2">
              <i class="bi bi-display"></i> Mutfak
            </button>
            <button id="btn-toggle-cashier"
              class="btn btn-outline-success btn-sm d-none d-lg-inline-flex align-items-center gap-2">
              <i class="bi bi-cash-stack"></i> Kasa
            </button>
          </div>

          <!-- Products Scroll Area -->
          <div id="categories" class="flex-grow-1 overflow-y-auto p-3 p-md-4">
            <!-- JS Injects Products Here -->
          </div>
        </div>

        <!-- Right: Ticket Sidebar (Desktop Only) -->
        <aside class="ticket-sidebar d-none d-lg-flex flex-column bg-darker border-start border-secondary"
          style="width: 350px;">
          <!-- Content injected via common function or duplicated? 
               We will use the same container ID 'ticketItemsContainer' but we need to handle mobile offcanvas.
               Actually, let's use ONE container and move it based on screen size? 
               No, easier to have the Offcanvas be the MAIN ticket container for simpler DOM.
               BUT Bootstrap Offcanvas is a modal-like overlay.
               
               Strategy: The "Ticket" checks screen size. 
               For now, let's keep Desktop Sidebar separate structure for layout stability.
          -->
          <div class="p-3 border-bottom border-secondary">
            <input type="text" id="calcName"
              class="form-control bg-dark text-white border-secondary text-center fw-bold"
              placeholder="MASA NO / MÜŞTERİ">
          </div>

          <div id="desktop-ticket-items" class="flex-grow-1 overflow-y-auto p-3">
            <ul id="liveCartList" class="list-unstyled mb-0"></ul>
          </div>

          <div class="p-3 bg-dark border-top border-secondary">
            <div class="d-flex justify-content-between mb-1 text-white-50 small"><span>Ara Toplam</span><span
                id="subTotal">0 $</span></div>
            <div class="d-flex justify-content-between mb-3 text-gold small"><span>Servis</span><span>+200 $</span>
            </div>
            <div class="d-flex justify-content-between mb-3 fs-4 fw-bold text-white"><span>TOPLAM</span><span
                id="totalPrice">0 $</span></div>
            <button id="saveButton" class="btn btn-gold w-100 fw-bold py-3 text-dark">SİPARİŞİ ONAYLA</button>
          </div>
        </aside>
      </div>

      <!-- VIEW: KDS -->
      <div id="kds-view" class="d-none w-100 h-100 bg-black overflow-y-auto p-3">
        <div class="container-fluid">
          <h2 class="text-white fw-bold mb-4"><i class="bi bi-fire text-danger me-2"></i>MUTFAK EKRANI</h2>
          <div id="kds-grid" class="row g-3"></div>
        </div>
      </div>

      <!-- VIEW: CASHIER -->
      <div id="cashier-view" class="d-none w-100 h-100 bg-black overflow-y-auto p-3">
        <div class="container-fluid">
          <h2 class="text-white fw-bold mb-4"><i class="bi bi-cash-stack text-success me-2"></i>KASA EKRANI</h2>
          <div id="cashier-grid" class="row g-3"></div>
        </div>
      </div>

    </main>

    <!-- 3. Bottom Navigation (Mobile Only) -->
    <nav class="mobile-nav d-lg-none bg-darker border-top border-secondary d-flex justify-content-around py-2">
      <button class="nav-item btn btn-link text-white-50 d-flex flex-column align-items-center active"
        onclick="switchView('pos')">
        <i class="bi bi-grid-fill fs-5"></i>
        <span class="x-small">Menü</span>
      </button>

      <button class="nav-item btn btn-link text-white-50 d-flex flex-column align-items-center position-relative"
        data-bs-toggle="offcanvas" data-bs-target="#ticketOffcanvas">
        <i class="bi bi-receipt fs-5"></i>
        <span class="x-small">Adisyon</span>
        <span id="mobileCartBadge"
          class="position-absolute top-0 start-50 translate-middle badge rounded-pill bg-gold text-dark d-none">0</span>
      </button>

      <button class="nav-item btn btn-link text-white-50 d-flex flex-column align-items-center" data-bs-toggle="modal"
        data-bs-target="#activeOrdersModal">
        <i class="bi bi-clock-history fs-5"></i>
        <span class="x-small">Açık</span>
      </button>

      <button class="nav-item btn btn-link text-white-50 d-flex flex-column align-items-center"
        data-bs-toggle="offcanvas" data-bs-target="#moreMenuOffcanvas">
        <i class="bi bi-three-dots fs-5"></i>
        <span class="x-small">Diğer</span>
      </button>
    </nav>

  </div>

  <!-- OFFCANVAS: Mobile Ticket -->
  <div class="offcanvas offcanvas-bottom h-75 bg-dark text-white" tabindex="-1" id="ticketOffcanvas">
    <div class="offcanvas-header border-bottom border-secondary">
      <h5 class="offcanvas-title fw-bold">Adisyon</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body p-0 d-flex flex-column" id="mobileTicketBody">
      <!-- Content mirrored from desktop via JS -->
      <div class="p-3">
        <input type="text" id="mobileCalcName" class="form-control bg-darker text-white border-secondary text-center"
          placeholder="Masa / Müşteri">
      </div>
      <div id="mobile-ticket-items" class="flex-grow-1 overflow-y-auto p-3">
        <!-- Clone of cart items -->
      </div>
      <div class="p-3 bg-darker mt-auto">
        <div class="d-flex justify-content-between fs-4 fw-bold mb-3"><span>Toplam</span><span id="mobileTotalPrice">0
            $</span></div>
        <button id="mobileSaveButton" class="btn btn-gold w-100 fw-bold py-3 text-dark">SİPARİŞİ ONAYLA</button>
      </div>
    </div>
  </div>

  <!-- OFFCANVAS: More Menu -->
  <div class="offcanvas offcanvas-end bg-dark text-white" tabindex="-1" id="moreMenuOffcanvas">
    <div class="offcanvas-header border-bottom border-secondary">
      <h5 class="offcanvas-title">Menü</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body p-0">
      <div class="list-group list-group-flush">
        <button class="list-group-item list-group-item-action bg-dark text-white border-secondary p-3"
          data-bs-toggle="modal" data-bs-target="#historyModal">
          <i class="bi bi-journal-check me-2"></i> Geçmiş İşlemler
        </button>
        <button class="list-group-item list-group-item-action bg-dark text-white border-secondary p-3"
          data-bs-toggle="modal" data-bs-target="#leaderboardModal">
          <i class="bi bi-trophy me-2"></i> Leaderboard
        </button>
        <!-- Dynamic Roles -->
        <button id="mobile-btn-kds"
          class="list-group-item list-group-item-action bg-dark text-white border-secondary p-3 d-none"
          onclick="switchView('kds'); bootstrap.Offcanvas.getInstance('#moreMenuOffcanvas').hide()">
          <i class="bi bi-display me-2"></i> Mutfak Ekranı
        </button>
        <button id="mobile-btn-cashier"
          class="list-group-item list-group-item-action bg-dark text-white border-secondary p-3 d-none"
          onclick="switchView('cashier'); bootstrap.Offcanvas.getInstance('#moreMenuOffcanvas').hide()">
          <i class="bi bi-cash-stack me-2"></i> Kasa Ekranı
        </button>

        <div class="p-3 mt-4">
          <div class="bg-surface rounded p-3 border border-secondary">
            <div class="text-center mb-3">
              <p class="text-muted small mb-1">Giriş Yapan</p>
              <h6 class="fw-bold text-gold mb-0" id="mobileActiveWaiter">-</h6>
            </div>
            <div class="row g-2">
              <div class="col-6">
                <div class="bg-darker p-2 rounded text-center">
                  <span class="d-block x-small text-white-50">SİPARİŞ</span>
                  <strong id="mobileWaiterOrderCount" class="text-white">0</strong>
                </div>
              </div>
              <div class="col-6">
                <div class="bg-darker p-2 rounded text-center">
                  <span class="d-block x-small text-white-50">SERVİS</span>
                  <strong id="mobileWaiterServiceShare" class="text-success">0 $</strong>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODALS (Reused logic, restyled) -->

  <!-- Active Orders -->
  <div class="modal fade" id="activeOrdersModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content bg-dark text-white border-secondary shadow-lg">
        <div class="modal-header border-secondary">
          <h5 class="modal-title fw-bold">Açık Masalar</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-0">
          <ul id="activeOrdersList" class="list-group list-group-flush"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- History -->
  <div class="modal fade" id="historyModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content bg-dark text-white border-secondary shadow-lg">
        <div class="modal-header border-secondary">
          <h5 class="modal-title fw-bold">Geçmiş</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-0">
          <ul id="calcList" class="list-group list-group-flush"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Leaderboard -->
  <div class="modal fade" id="leaderboardModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content bg-dark text-white border-secondary shadow-lg">
        <div class="modal-header border-secondary">
          <h5 class="modal-title fw-bold">Leaderboard</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-0">
          <ul id="leaderboardList" class="list-group list-group-flush"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div class="modal fade" id="waiterModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-sm">
      <div class="modal-content bg-dark text-white border-secondary shadow-lg">
        <div class="modal-body p-4 text-center">
          <div class="mb-4"><i class="bi bi-person-circle display-1 text-gold"></i></div>
          <h5 class="fw-bold mb-3">Casa Carmaretti</h5>
          <input type="text" class="form-control form-control-lg bg-darker text-white border-secondary text-center mb-3"
            id="waiterModalInput" placeholder="İsim Giriniz">
          <button type="button" class="btn btn-gold w-100 py-2 fw-bold text-dark" id="waiterModalSave">GİRİŞ
            YAP</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Hidden Receipt Canvas -->
  <canvas id="receiptCanvas" hidden></canvas>

  <!-- Toast Container -->
  <div class="toast-container position-fixed top-0 end-0 p-3"></div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script>
    // Firebase global variables
    window.FIREBASE_API_KEY = "__FIREBASE_API_KEY__";
    window.FIREBASE_AUTH_DOMAIN = "__FIREBASE_AUTH_DOMAIN__";
    window.FIREBASE_DATABASE_URL = "__FIREBASE_DATABASE_URL__";
    window.FIREBASE_PROJECT_ID = "__FIREBASE_PROJECT_ID__";
    window.FIREBASE_STORAGE_BUCKET = "__FIREBASE_STORAGE_BUCKET__";
    window.FIREBASE_MESSAGING_SENDER_ID = "__FIREBASE_MESSAGING_SENDER_ID__";
    window.FIREBASE_APP_ID = "__FIREBASE_APP_ID__";
  </script>
  <script type="module" src="./js/ui.js"></script>
</body>

</html>